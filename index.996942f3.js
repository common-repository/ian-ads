!function(u){u(function(){for(var n=/^[3456789bcdfghjkmnpqrstvwxyBCDFGHJKMNPQRSTVWXY]+$/,o=u("#ian-ad-slots"),l=o.find(".form-table tr"),a=0;a<l.length;a++)u(l[a]).data("code",a);var e=!1;u("#update-slots-btn, #update-slots-icon").click(function(t){return confirm("This will remove all existing slot codes and replace them from IAN's system. Are you sure?")&&(l.removeClass("show"),o.find("input.button").prop("disabled",!0),u("#ad-slot-form").addClass("working"),u.ajax({url:ajaxurl,data:{action:"ian_reload_slot_codes"},dataType:"json"}).always(function(t){if("status"in t)alert("There was a problem refreshing slot code information. Please try again and if the problem persists, contact us.");else for(a=0;a<t.length;a++)u(l[a]).find("input[data-slot-name]").val(t[a].name),u(l[a]).find("span.slot-name").text(t[a].name),u(l[a]).find("input.slot-code").val(t[a].code);u("#ad-slot-form").removeClass("working"),o.find("input.button").prop("disabled",!1),i(),r()})),!1});var s=0,i=function(){s=0,u.each(l,function(t,o){$row=u(o),""!=u.trim($row.find("input.slot-code").val())?($row.addClass("show"),s++):""==$row.find("input[data-slot-name]").val()&&$row.removeClass("show")})};i();var r=function(){s<10?u("#add-slot").addClass("show"):u("#add-slot").removeClass("show"),0==s?(u("#no-slots-msg").addClass("show"),u("#has-slots-msg").removeClass("show")):(u("#no-slots-msg").removeClass("show"),u("#has-slots-msg").addClass("show"))};r();var d=function(){for(var t=l.length-2,o=t;0<=o;o--){var a=u(l[o]);if(""==u.trim(a.find("input.slot-code").val())&&""==u.trim(a.find("input[data-slot-name]").val()))for(var n=o;n<=t;n++){var e=u(l[n]),s=u(l[n+1]);e.find("input.slot-code").val(u.trim(s.find("input.slot-code").val())),e.find("input[data-slot-name]").val(u.trim(s.find("input[data-slot-name]").val()))}}};u("#add-slot").click(function(){for(var t=0;t<l.length;t++){var o=u(l[t]);if(!o.hasClass("show")){o.addClass("show"),o.find("input.slot-code").focus(),s++,e=!0,r();break}}}),o.find(".remove-button").click(function(t){for(var o=parseInt(u(t.target).data("id"))+1;o<l.length;o++)u(l[o-1]).find("span.slot-name").text(u(l[o]).find("span.slot-name").text()),u(l[o-1]).find("input.slot-code").val(u(l[o]).find("input.slot-code").val()),u(l[o-1]).find("input[data-slot-name]").val(u(l[o]).find("input[data-slot-name]").val()||"");u(l[l.length-1]).find("input.slot-code").val(""),u(l[l.length-1]).find("input[data-slot-name]").val(""),e=!0,d(),i(),r()}),u("#ad-slot-form").submit(function(t){for(var o=codeCount=0;o<l.length;o++){var a=u(l[o]).find("input.slot-code");if(a.val(u.trim(a.val())),""!=a.val()){if(codeCount++,null==a.val().match(n))return alert("Slot Code "+(o+1)+" does not contain a valid Code. It should contain only consonants and numbers"),a.focus(),!1}else if(""!=u.trim(u(l[o]).find("input[data-slot-name]").val()))return alert("Slot Code "+(o+1)+" is a registered slot. Please refresh slot codes to ensure correct values are kept or remove this slot code rather than clearing out the input box."),a.focus(),!1}if(0==codeCount){if(!confirm("There are no slot codes currently. Are you sure you want to save?"))return!1}else d();return!(e=!1)}),u(window).bind("beforeunload",function(){if(e)return"You have unsaved changes on this page. Are you sure you want to leave without changing?"}),o.find("input[type=text]").keypress(function(){e=!0})})}(jQuery);